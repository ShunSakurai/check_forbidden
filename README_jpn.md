# check_forbidden
memoQバイリンガルファイル(.mqxlz/.mqxliff)の訳文中に禁止されている訳語が使用されていないか確認するためのツールです。

[英語のREADME](https://github.com/ShunSakurai/check_forbidden/blob/master/README.md)もあります。

![UI](https://raw.github.com/wiki/ShunSakurai/check_forbidden/check_forbidden_ui.png)

## 説明
memoQでは、禁止されている原語と訳語のペアを検証することはできますが、**禁止されている訳語のみを**、対応する原語に関係なく検証することはできません。
このツールを使用すると、memoQのバイリンガルファイルで使用されている禁止語を素早く絞り込み、memoQでその用語を発見できます。これにより、翻訳の品質を効率的に維持することができます。

このツールは、例えば次のような状況で使用できます。

- スタイルガイドにより、訳文中に「doesn't」や「can't」のような短縮系を使用できない場合
- 「US$1,000」という通貨の形式は使用できるが、「US 1,000 ドル」という表記はできない場合
- JP (日本語):「次の/次に」は使用できるが、「以下の/以下に」は使用できない場合
- JP:「例えば」を漢字にする必要があり、「たとえば」は使用できない場合

用意するものは次のとおりです。

- memoQのバイリンガルファイル(.mqxlzまたは.mqxliff形式)
- 禁止語の一覧を含むCSVファイルまたはテキストファイル

バイリンガルファイル中の禁止語を検索し、コマンドプロンプトに結果を表示し、さらに検索結果をCSVファイルにエクスポートします。コマンドプロンプトは、結果をざっと読み、検出された用語を簡単に確認するのに適しています。CSVファイルは、情報の検索と保存に向いています。「ビュー」を使って作業している場合は、まとめ結果が便利です。

このプログラムは、Pythonとtkinterを使用してコーディングし、[py2exe](http://www.py2exe.org/)を使用して.exe形式で配布するものです。

## インストール
現在、Windowsにのみ対応しています。プログラムファイルは[Releases(リリース)](https://github.com/ShunSakurai/check_forbidden/releases)で入手できます。
インストーラーは現在開発中です。当面は、次の手順を実行してください。

- dist.zipをダウンロードし、解凍します
- フォルダー名を「Check Forbidden」など、お好みの名前に変更します。
- フォルダーをC:\Program Filesに移動します
- .exeファイルへのショートカットを作成し、それをデスクトップ、ツール用フォルダー、C:\ProgramData\Microsoft\Windows\Start Menu\Programsなどに追加します

更新版を使用する場合、日付が新しいファイルやフォルダーのみを移動することで使用できます。
このプログラムが動作するには**フォルダーに含めたまま**にしておく必要があります。プログラム単体では動作しません。

Python環境をインストールしている場合、`python(3) check_forbidden.py`または`import check_forbidden`でソースコードをMacなど任意のOSで実行できます。

## 使用方法

### 概要
プログラムを開くには、Check Forbidden.exeをダブルクリックします。

- 「Bilingual」(バイリンガル)をクリックするか、ファイルへのパスを入力または貼り付けることで、バイリンガルファイルを選択します
- 禁止語の一覧を含むCSVファイルまたはテキストファイルを選択します
- エクスポートする結果ファイルのパスとファイル名を選択します。既定値は、1つ目のバイリンガルファイルのパス + "checked_result.csv"です
- 「Run!」(実行)をクリックします

- 結果はコマンドプロンプトに表示され、一致する結果が見つかった場合は、CSVファイルにもエクスポートされます
- ある用語が1つのファイル中で一度見つかると、そこで検索を中止して次の用語に移ります
- 結果はファイルごとと、ファイル全体についての「Summary」(まとめ)として表示されます
- プログラムを閉じるには、「Enter」キーを押すか、「X」(閉じる)ボタンをクリックします
- プログラムを開いたまま、何度も繰り返し実行できます
- 結果ファイルとして既存のCSVファイルを選択すると、結果はファイルの末尾に追加されます

![結果](https://raw.github.com/wiki/ShunSakurai/check_forbidden/check_forbidden_result.png)

### オプション
検索の対象とするセグメントの種類を指定できます。オプション画面を表示するには、歯車⚙アイコンをクリックします。画面を隠すには、三角▲アイコンをクリックします。

![オプション](https://raw.github.com/wiki/ShunSakurai/check_forbidden/check_forbidden_options.png)

### memoQファイルの種類
次の2種類のファイルに対応しています。

- .mqxliff
- .mqxlz

.mqxlzファイルは、document.mqxliffファイル、スケルトン(書式情報)、バージョン情報(場合により)を圧縮したファイルです。本プログラムでは、document.mqxliffをフォルダーに展開し、処理の終了後に削除しています

### CSVファイルの形式
各項目はコンマで区切ります。ファイルはUTF-8でエンコードし、次のいずれかの形式にしてください。

- 禁止語の1列
- 禁止語と、追加情報(例: 正しい語)の2列
- **1列目**の用語が禁止語とみなされます

または

- 3列以上 (例: 通し番号、原語、訳語(禁止)、訳語(正))
- **3列目**の用語が禁止語とみなされます

![CSV](https://raw.github.com/wiki/ShunSakurai/check_forbidden/check_forbidden_csv.png)

エクスポートされる結果のCSVファイルも、UTF-8でエンコードされ、コンマで区切られています。

### キーボードショートカット
キーボードで下線の付いた文字を押すことで、ボタンとラジオボタンを選択することができます。下線の付いていないその他のボタンについては、次のキーで呼び出すことができます。

- Run! - スペースバー
- オプションの表示/非表示 - Oキー

Enter(Return)キーは、フォーカスされたウィジェットを呼び出すために使用できます。

- カーソルが入力欄にある場合、キーボードショートカットは無効になります。これにより、欄に文字を直接入力できます。


## 既知の問題と対処法

### コマンドプロンプトの文字化け
Windowsのコマンドプロンプトでマルチバイト文字が文字化けしているように見える場合があります。タイトルバーを右クリックし、「プロパティ/フォント」を選択し、別のフォントを選択すると、この問題が解決します。Alt + スペース、Pを順番に押すと、プロパティを素早く開くことができます。

![文字化け](https://raw.github.com/wiki/ShunSakurai/check_forbidden/check_forbidden_garbled.png)

### 単語の区切りは考慮されません
本プログラムでは、各セグメントを単なる文字列として扱います。各単語は区別しません。

- 「play」は「playing」とも「display」とも一致します

### 大文字と小文字は区別されます
本プログラムでは、大文字と小文字は区別されます。必要な場合には、大文字と小文字の両方で用語をCSVファイルに追加してください。

### 誤検出に注意
誤検出を防ぐための工夫を次に示します。

タグや特殊文字に使用されている1文字の記号を使用しないようにします。

- <、/、>、&、;、などを追加しないようにします

空白文字を追加します。

- 「display」との一致を防ぐには、CSVに「 play」(半角スペース + play)を追加します

漢字1文字の語など、短すぎる用語を使用しないようにします。

- JP:「等級」との一致を防ぐには、「等」(など)を追加しないようにします

### Summary結果が順番に表示されない
Pythonの集合型オブジェクトを使用して結果をまとめています。そのため、まとめ結果が正しい順番で表示されないという問題が発生しています。この問題の解決に向けて取り組んでいます。

### Shift-JISのExcelで開いたCSVファイルの文字化け
デフォルトエンコーディングがShift-JISの環境で、UTF-8でエンコードされたCSVファイルをMicrosoft Excelで開くと、文字化けが起きます。対処法はいくつかありますが、簡単な対策を次に挙げます。

- 拡張子を.csvから.txtに変更します。ダイアログウィンドウが開き、エンコーディングを選択できます
- CSVファイルをメモ帳で開きます。各行は単に横に並んで表示され、項目は区切られませんが、表示は正しくなります
- [OpenOffice](https://www.openoffice.org/product/calc.html) CalcなどのCSVを開くソフトウェアをダウンロードします

## 今後追加予定の機能
### 開発中の機能
- コードの[リーダブル](http://www.amazon.co.jp/dp/4873115655)化
- まとめ結果を整列
- インストーラーを用意
- アイコンを用意
- 画面の大きさの自由変更
- 「ファイルを開く」ダイアログの使いやすさを改善
- バイリンガルファイル欄にパスを入力または貼り付ける場合も、エクスポートする結果ファイルのパスとファイル名候補を表示
- コンテキストを含めて結果を表示
- 結果にmemoQのセグメントIDを表示

### 棚上げ中の機能
- ファイルをドラッグで追加
- 複数のバイリンガルファイルを別のフォルダーから選択
- バイリンガルファイル欄の{波かっこ}を非表示
- 禁止語の列を指定するための設定
- CSVの区切り文字を指定するための設定
- エクスポート方法(コマンドプロンプト/CSVファイル)を選択するためのラジオボタン
- memoQ以外のファイルへの対応
- 禁止語一覧での正規表現の対応
- 入力欄のパスを、ボタンを押したときの初期パスに設定
- [Microsoftスタイルガイド](https://www.microsoft.com/Language/ja-JP/StyleGuides.aspx)の禁止語リストを例として作成

すぐに使用したい機能がある場合はご連絡ください。

## 履歴
文頭の「*」は、バグ修正を示します。
履歴の詳細は、[Releases(リリース)](https://github.com/ShunSakurai/check_forbidden/releases)でご覧ください。

### v1.4.7、2016年4月28日
- 検索結果の上部に、現在時刻、CSVファイルの名前、使用したオプションを表示
- Return(Enter)キーに、各ウィジェットのイベントを割り当て
- * 結果CSVファイルがすでに開かれている場合にフォルダーが削除されない問題を解決

### v1.4.4、2016年4月28日
- プログラムを初めて使うユーザーに向けた情報を追加
- カーソルが入力欄にある場合、キーボードショートカットを無効化
- 2つ目のボタンの名前を「CSV」から「Terms」に変更
- * filetypes引数が複数の場合にMacでファイルを選択できなくなる問題を解決

### v1.4.0、2016年4月23日
- アプリケーションの名前を「Check Forbidden」に変更
- 結果ファイルのファイル名の末尾に.csvを必ず追加
- distフォルダーのサイズを縮小
- .mqxlzファイルと.mqxliffファイルを同時選択
- 起動時のメッセージを追加
- * 既知の問題を追加:タグや特殊文字に使用されている1文字の記号を使用しないようにします

### v1.3.0、2016年4月12日
- オプションアイコンを変更
- キーボードショートカットを追加
- 101%マッチと100%マッチを除外する機能
- ロックされたセグメントを除外する機能
- オプションを表示するための、拡張画面を作成
- 各ボタンのテキストガイドを追加、統一
- エクスポートされるCSVファイル中のまとめ結果の後に改行を追加
- スクリプト部分とUI部分を分割(UI部分がメイン)
- * WorldServerからエクスポートされたバイリンガルファイルに付加されるTMエントリを検索から除外
- * Runボタンが無効なときでも押せてしまう問題を解決

### v1.1.3、2016年4月7日
- CSVファイル中のまとめ結果を分割
- distフォルダー内のファイルの数を削減
- ボタン名と、エクスポートするCSVファイルのデフォルト名を変更
- * 既知の問題を追加:マルチバイト文字の文字化けを修正するには、コマンドプロンプトのフォントを変更します

### v1.1.0、2016年3月31日
- バイナリファイルを配布
- デザインをわずかに改善
- README_jpn.mdを作成

### v1.0.10、2016年3月28日
- 言語ペアを英->日からより一般的な原語->訳語に変更
- README.mdを作成
- * バイリンガルファイルの解析時に正規表現を使用するため、バイリンガルファイルの選択肢から.txt形式を削除

### v1.0.9、2016年3月24日
- * 禁止語が見つからない場合にフォルダーが削除されない問題を解決

### v1.0.8、2016年3月24日
- GitHubに追加

### v1.0.0、2016年3月22日
### v0.9.0、2016年3月17日
- 社内で使用開始

### 2015年12月8日
- [Pythonの入門書](http://www.amazon.co.jp/dp/4797371595)を購入

### 2015年7月30日
- 発案

## 貢献
これは個人的なプロジェクトにすぎませんが、どんなご意見や貢献でもいただけると幸いです。

同僚の翻訳者やPMの皆さん、このページの英語や訳語を自然な文にするお手伝いをしていただけたら幸いです。

## 使用権限
このツールは無料でお使いいただけます。

© 2016 Shun Sakurai
